<!DOCTYPE html>
<html>
  <head>
     <title>Octo</title>
     <link rel="icon" type="image/png" href="iifavicon.png"/>
    
    <style>
      body {
        font-size: 22px;
      }
      
      .checkbox-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 1rem;
      }
      
      .checkbox {
        color: #FFFFFF;
        background-color: #000000;
        padding: 0.5rem;
        margin: 0.5rem;
      }

      .button-container {
        display: flex;
        align-items: center;
        margin: 1rem;
      }

      .prompt {
        background-color: #102010;
        color: #ECE49C;
        font-family: "Montserrat";
        font-size: 2rem;
        width: 900px;
        height: 140px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        margin: 1rem;
      }


      .container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 65vh;
      }

    
       .background-image {
        background-image: url("bluebackground.jpg");
        background-size: cover;
        background-position: center;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
      }     
    </style>
  </head>
  <body>
    
    <canvas id="Canvas1" width="100" height="100" style="border:2px solid #d3d3d3"></canvas>
    <br>
 
    <textarea name="text" id="urltext" cols="80" rows="1"></textarea>
    <br>
    
   
    <div class="checkbox-container">

      <div class="checkbox">
        <label for="abc">Size</label>
          <select name="abc" id="qual">
            <option value=".5">Small</option>
            <option value="1">Medium</option>  
            <option value="2">Large</option>
          </select>
      </div>
      <div class="checkbox">
        <label for="API">API</label>
        <select name="api" id="api">
          <option value="Octo1">Octo SD</option> 

        </select>
      </div>

    </div>

    <div class="container">
      <div class="background-image"></div>
      <div id="prompt" contenteditable="true" class="prompt"></div>
        <div class="flex3">
    
        <button id="url-button">Get Image</button>
      </div>
    </div>

    
  <script>
    
    const urlButton = document.getElementById("url-button");
    const promptDiv = document.getElementById("prompt");
    
    urlButton.style.font = "4vw Montserrat"
    var promp="",retURL=""

    var c1 = document.getElementById("Canvas1")
    var ct1 = c1.getContext("2d")
    
    var img =new Image()
    var dims
    
    var screenw=window.innerWidth, screenh=window.innerHeight
    var size=Math.floor(.184*screenw)
    
    c1.width=size; c1.height=size
    
    var urlElem=document.getElementById('urltext')
    urlElem.value="Type prompt then GetImage"
// When the image is loaded, create a canvas and draw the image on it
img.onload = function() {
  c1.width = this.naturalWidth; 
  c1.height = this.naturalHeight; // or 'height'
  ct1.drawImage(this, 0, 0);
};

    /*
c1.addEventListener("click", function() {
if(retURL.length>10){
  win = window.open(retURL, '_blank');   win.focus(); }
})
*/


function clearWins(){
ct1.clearRect(0,0,size,size)
}

  urlButton.addEventListener("click", octo)
    
  function octo(){
    promp= promptDiv.innerHTML

     alert('Get Octo Image '+promp)

  
apiKey='eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjNkMjMzOTQ5In0.eyJzdWIiOiJkN2YyODU3MC01MzAzLTQ2YjUtOWY5Zi03ZDYyOTdjYWUzYzkiLCJ0eXBlIjoidXNlckFjY2Vzc1Rva2VuIiwidGVuYW50SWQiOiI3ZmNhNjNjZC0yY2E1LTRjOGQtYWIzZC1jYjVkNDk3ZWZjODgiLCJ1c2VySWQiOiJmM2MyYWRiNC01Y2ZmLTRhMjgtOWJlYy02NGMyMzYyMjBhYjgiLCJyb2xlcyI6WyJGRVRDSC1ST0xFUy1CWS1BUEkiXSwicGVybWlzc2lvbnMiOlsiRkVUQ0gtUEVSTUlTU0lPTlMtQlktQVBJIl0sImF1ZCI6IjNkMjMzOTQ5LWEyZmItNGFiMC1iN2VjLTQ2ZjYyNTVjNTEwZSIsImlzcyI6Imh0dHBzOi8vaWRlbnRpdHkub2N0b21sLmFpIiwiaWF0IjoxNjg3MDQ3NTc1fQ.TDZe63vnwJsrHMx-Tn4mM8xhO2uL_k5WiKTKcFfW1tDdDBHPexvwXVCVn7UnL7V2rfX_mszi0jro9fKMTFmQARnl6Z-_-gQWCr8zHzFlR6JWKx2ohPhzmQJmWpK3Pl21eQNl7VTF3K552x4T2i1FzN6nI-TgjFSYTZtZwHGiXyDb-ttoR-EWqH0LHHuF7cUTbWJecxcIRm1_OShsL0bFqXtT54GfHPB0tgwMP_7y3lqVjnSe9w-sHW-4iQJRUk3xTP5qa2p8V-rgRhA01tGQEYFVg7yK7zC35VlL1TZqK1TgEiOjiVkTi1w8Iy1nMe2Tob4saxddwZDFDSf75FPxeA' 

 fetch('https://stable-diffusion-demo-8yn9n69web73.octoai.cloud/predict', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${apiKey}`
  },
  body: JSON.stringify({
    'prompt': promp,
    'guidance_scale': 7.5,
    'num_inference_steps': 30,
    'sheduler': 'DPMSolverMultistep'
  })
})
.then(response => response.json())
.then( data=> {
  strn=JSON.stringify(data)
  arr=strn.split(':')
  raw=arr[1].slice(1)
  console.dir('response= '+data)
  raw2=raw.slice(0,-2)
 
var base64 = "data:image/png;base64,"+raw2

img.src = base64;

    //displayBase64ImageOnCanvas(data[1], 'Canvas1');
}
      )

.catch(error => alert('err='+error));
    
}
    

  </script>
  </body>
</html>
